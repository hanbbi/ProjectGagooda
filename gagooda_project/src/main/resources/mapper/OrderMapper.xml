<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.gagooda_project.mapper.OrderMapper">
    <resultMap id="orderMap" type="orderDto" autoMapping="true">
        <id column="order_id" property="orderId"/>
        <result column="user_id" property="userId"/>
        <result column="address_id" property="addressId"/>
        <result column="total_price" property="totalPrice"/>
        <result column="user_name" property="userName"/>
        <result column="user_email" property="userEmail"/>
        <result column="user_phone" property="userPhone"/>
        <result column="post_code" property="postCode"/>
        <result column="address_detail" property="addressDetail"/>
        <result column="receiver_name" property="receiverName"/>
        <result column="receiver_phone" property="receiverPhone"/>
        <result column="img_path" property="imgPath"/>
        <result column="o_det" property="oDet"/>
    </resultMap>
    <select id="listOrder" resultMap="orderMap">
        SELECT * FROM ORDER_DB
    </select>
    <select id="findByPaging" resultMap="orderMap">

    </select>
    <select id="listByUserIdAndDate" resultMap="orderMap">
        SELECT * FROM ORDER_DB WHERE user_id=#{id} AND date BETWEEN DATE_SUB(NOW(),INTERVAL #{searchDate} DAY) AND NOW()
    </select>
    <select id="countByUserId" resultType="int">
        SELECT COUNT(*) FROM ORDER_DB WHERE user_id=#{id}
    </select>
    <select id="countOrderByNotStatus" resultType="int">
        SELECT COUNT(*) FROM ORDER_DB WHERE user_id=#{id} AND NOT o_det= 'od2'
    </select>

    <select id="listOrderByStatus" resultMap="orderMap">
        SELECT * FROM ORDER_DB WHERE o_det=#{det}
    </select>
    <select id="listOrderByDate" resultMap="orderMap">
        SELECT * FROM ORDER_DB WHERE date BETWEEN DATE_SUB(NOW(), INTERVAL #{searchDate} DAY) AND NOW();
    </select>
    <select id="countByUserIdAndStatus" resultType="com.example.gagooda_project.dto.ODetDto">
        SELECT o_det, count(o_det) FROM ORDER_DB WHERE user_id=#{id} GROUP BY o_det
    </select>
    <select id="findById" resultType="com.example.gagooda_project.dto.OrderDto">
        SELECT * FROM ORDER_DB WHERE order_id=#{id}
    </select>
    <insert id="insertOne">
        INSERT INTO ORDER_DB (order_id, user_id, address_id, total_price, user_name, user_email, user_phone, post_code, address, address_detail, receiver_name, receiver_phone, elevator, img_path, o_det)
        VALUES (order_id=#{orderId}, user_id=#{userId},address_id=#{addressId}, total_price=#{totalPrice}, user_name=#{userName}, user_email=#{userEmail}, user_phone=#{userPhone},post_code=#{postCode}, address=#{address}, address_detail=#{addressDetail}, receiver_name=#{receiverName}, receiver_phone=#{receiverPhone}, elevator=#{elevator}, img_path=#{imgPath}, o_det=#{oDet})
    </insert>
    <update id="updateStatus">
        UPDATE ORDER_DB SET o_det=#{det} WHERE order_id=#{id}
    </update>


</mapper>