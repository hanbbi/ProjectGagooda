<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" >
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<form action="/product/admin/register.do" enctype="multipart/form-data" method="post" name="productForm">
    <label for="productCode">상품 코드:</label>
    <input type="text" id="productCode" name="productCode" required>
    <br>
    <label for="pDet">상품 상태:</label>
    <select name="pDet" id="pDet" required>
        <option value="p1">p1</option>
        <option value="p2">p2</option>
    </select>
    <br>
    <label for="name">상품명:</label>
    <input type="text" id="name" name="name" required>
    <br>
    <label for="place">판매처:</label>
    <input type="text" id="place" name="place" required>
    <br>
    <label for="supplyPc">공급 가격:</label>
    <input type="number" id="supplyPc" name="supplyPc" required>
    <br>
    <label for="salesPc">판매 가격:</label>
    <input type="number" id="salesPc" name="salesPc" required>
    <br>
    <label for="deliveryPc">배송 가격:</label>
    <input type="number" id="deliveryPc" name="deliveryPc" required>
    <br>
    <label for="rot">과세율:</label>
    <input type="text" id="rot" name="rot">
    <br>
    <label for="rot">마진율:</label>
    <input type="text" id="margin" name="margin">
    <br>
    <label for="imgCode">이미지코드:</label>
    <input type="hidden" id="imgCode" name="imgCode">
    <br>
    <div class="option-products">
        <fieldset class="option">
            <legend>옵션 1</legend>
            <label for="optionProductCode">옵션 코드:</label>
            <input type="text" id="optionProductCode" name="optionProductList[0].optionCode">
            <br>
        </fieldset>
    </div>
    <br>
    <button type="button" name="moreOptBtn">옵션추가</button>
    <br>
    <div class="categories">
        <fieldset class="category conn1" data-name="대분류">
            <legend>대분류</legend>
            <label for="1">거실</label>
            <input type="checkbox" id="1" value="1" class="categoryBox" name="categoryId">
            <label for="2">침실</label>
            <input type="checkbox" id="2" value="2" class="categoryBox" name="categoryId">
        </fieldset>
        <fieldset class="category conn2" data-name="중분류">
            <legend>중분류</legend>
            <label for="11">의자</label>
            <input type="checkbox" id="11" value="11" class="categoryBox" name="categoryId">
            <label for="12">탁자</label>
            <input type="checkbox" id="12" value="12" class="categoryBox" name="categoryId">
            <label for="21">침대</label>
            <input type="checkbox" id="21" value="21" class="categoryBox" name="categoryId">
            <label for="22">조명</label>
            <input type="checkbox" id="22" value="22" class="categoryBox" name="categoryId">
        </fieldset>
        <fieldset class="category conn3" data-name="소분류">
        </fieldset>
    </div>
    <br>
    <button type="submit">제출</button>

</form>
</body>
<script>
    const productForm = document.forms["productForm"];
    const moreOptBtn = productForm["moreOptBtn"];
    const optionProducts = productForm.querySelector(".option-products");
    let i=1;
    moreOptBtn.onclick=(e)=>{
        let option = document.createElement("fieldset");
        option.className = "option";

        let legend = document.createElement("legend");
        legend.innerText=`옵션 ${i+1}`
        option.append(legend);

        let label = document.createElement("label");
        label.innerText = "옵션 코드:"
        label.htmlFor = "optionProductCode"
        option.append(label);

        let input = document.createElement("input");
        input.type = "text";
        input.id = "optionProductCode";
        input.name = `optionProductList[${i}].optionCode`;
        option.append(input);

        optionProducts.append(option);
        i++;
    }

    productForm.onsubmit=(e)=>{
        let i=0;
        const categories = productForm.querySelector(".categories");
        const fieldSets = categories.querySelectorAll(".category");
        fieldSets.forEach(fieldset => {
            const checkBoxes = fieldset.querySelectorAll(".categoryBox");
            const checkedBoxes = [];
            checkBoxes.forEach(checkBox=>{
                if (checkBox.checked) checkedBoxes.push(checkBox);
            });
            if (!fieldset.classList.contains("conn3") && checkedBoxes.length === 0) {
                e.preventDefault();
                alert(`최소 한개의 ${fieldset.dataset.name}를 선택해야 합니다.`);
            }
        });
    }

</script>
</html>