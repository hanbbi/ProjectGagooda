<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout/layout.html}">
<head>
    <meta charset="UTF-8">
    <title>사용자 회원가입</title>

</head>
<div layout:fragment="content">

<form action="/user/signup.do" method="post" class="container mt-5" style="width: 40%; margin-bottom: 200px" name="signupForm">
    <input type="hidden" th:value="${gDet}" name="gDet">

    <div class="mx-auto" >
        <img th:src="@{'/html_img/LOGO_BG.png'}" class="d-block mx-auto mb-5" style="width: 240px">
    </div>
    <div class="mb-3">
        <label for="email" class="form-label">이메일</label>
        <input type="email" class="form-control form-control-lg" id="email" name="email" placeholder="name@example.com" required>
    </div>
    <div class="mb-3">
        <label for="uname" class="form-label">이름</label>
        <input type="text" class="form-control form-control-lg" id="uname" name="uname" required>
    </div>
    <div class="mb-3">
        <label for="nickname" class="form-label">닉네임</label>
        <input type="text" class="form-control form-control-lg" id="nickname" name="nickname" required>
    </div>
    <div class="mb-3">
        <label for="pw" class="form-label">비밀번호</label>
        <input type="password" class="form-control form-control-lg" id="pw" name="pw" required>
    </div>
    <div class="mb-3">
        <label for="check" class="form-label">비밀번호 확인</label>
        <input type="password" class="form-control form-control-lg" id="check" name="check" required>
    </div>
    <div>
        <span style="color: #cc4040"></span>
    </div>
    <label for="phone" class="form-label">전화번호</label>
    <div class="input-group mb-3">
        <input type="text" class="form-control form-control-lg" id="phone" name="phone" aria-label="Recipient's username" aria-describedby="basic-addon2" required>
        <button type="button" class="input-group-text" onclick="onClickCertification()" style="background-color: #FFFAF5; color: #B68C68"  id="basic-addon2">인증번호 받기</button>
    </div>
    <div class="mb-3">
        <label for="varify" class="form-label">인증번호 입력</label>
        <input type="text" class="form-control form-control-lg" id="varify" name="varify" required>
    </div>
    <div class="form-check form-check-reverse">
        <input class="form-check-input" type="checkbox" name="" id="private-data" required>
        <label class="form-check-label" for="private-data">
            개인정보 수집 및 이용 동의
        </label>
    </div>
    <div class="form-check form-check-reverse">
        <input class="form-check-input" type="checkbox" name="emailCheck" id="emailCheck" checked>
        <label class="form-check-label" for="emailCheck">
            광고 및 업데이트 관련 이메일 수신 동의
        </label>
    </div>
    <div class="mb-3">
        <input type="submit" class="form-control form-control-lg text-white my-5" value="가입하기" style="background-color: #B68C68;">
    </div>
</form>

<script>
    const signupForm = document.forms["signupForm"];
    const pw = signupForm["pw"];
    const check = signupForm["check"];
    function pwcheck() {
        if (pw.value === check.value) {

        }
    }


    var IMP = window.IMP;
    IMP.init("imp61025700");

    function onClickCertification() {
        console.log("click");
        /* 2. 본인인증 데이터 정의하기 */
        const data = {
            merchant_uid: `mid_${new Date().getTime()}`, // 주문번호
            company: '아임포트', // 회사명 또는 URL
            // carrier: 'KT', // 통신사
            // name: '양한나', // 이름
            // phone: '01043302309', // 전화번호
            popup: false
        };

        /* 4. 본인인증 창 호출하기 */
        IMP.certification(data, callback);
    };

    /* 3. 콜백 함수 정의하기 */
    function callback(response) {
        const {
            success,
            merchant_uid,
            error_msg
        } = response;

        if (success) {
            console.log('본인인증 성공')
            console.log(response.imp_uid);
            jQuery.ajax({
                url: "/user/certifications.do",
                method: "POST",
                headers: { "Content-Type": "application/json" },
                data: JSON.stringify({ imp_uid: response.imp_uid }),
                success: function (data) {
                    JSON.parse(data)
                },
                error: function(e) {
                    console.log(e)
                }
            });
        } else {
            console.log(`본인인증 실패: ${error_msg}`);
        }
    }

</script>
</div>

</html>